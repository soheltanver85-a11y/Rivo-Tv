<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Universal TV Modern - Mobile & TV</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
:root{
--primary:#ff2a2a;
--bg:#050505;
--card:#1a1a1a;
--glass:rgba(255,255,255,.06);
--glow:0 0 20px rgba(255,42,42,.6);
--focus:#fff;
}

/* GENERAL */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body,html{background:radial-gradient(circle at top,#111,#000 60%);color:#fff;overflow:hidden;height:100%;font-size:16px;}
.app{display:flex;height:100vh;}

/* SIDEBAR */
.sidebar{width:80px;background:#000;display:flex;flex-direction:column;align-items:center;gap:20px;padding-top:20px;border-right:1px solid #222;}
.nav-btn{background:var(--glass);border:none;border-radius:999px;padding:12px 16px;font-size:20px;color:#ccc;cursor:pointer;transition:.3s;}
.nav-btn.active{background:var(--primary);color:#fff;box-shadow:var(--glow);}

/* MAIN */
.main{flex:1;display:flex;flex-direction:column;}

/* VIDEO */
.video-box{height:45vh;background:#000;position:relative;border-bottom:1px solid rgba(255,255,255,.08);}
video{width:100%;height:100%;object-fit:contain;background:#000;border-radius:8px;}
#loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:50px;height:50px;border:5px solid #eee;border-top:5px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;display:none;z-index:10;}
@keyframes spin{100%{transform:translate(-50%,-50%) rotate(360deg)}}
#now{position:absolute;bottom:14px;left:14px;background:rgba(0,0,0,.6);padding:10px 16px;border-radius:10px;font-weight:700;font-size:20px;}

/* TOP SEARCH + CATEGORY */
.top{padding:12px;border-bottom:1px solid #222;display:flex;flex-direction:column;gap:10px;}
.search{width:95%;padding:12px;font-size:16px;background:#222;color:#fff;border:none;border-radius:12px;outline:none;}
.cat-bar{display:flex;gap:10px;overflow-x:auto;white-space:nowrap;padding:0 5px;}
.cat-bar::-webkit-scrollbar{display:none;}
.cat-btn{padding:8px 16px;border-radius:999px;background:var(--glass);border:none;color:#ccc;cursor:pointer;flex-shrink:0;font-size:14px;transition:.25s;}
.cat-btn.active{background:var(--primary);color:#fff;box-shadow:var(--glow);}

/* GRID */
.grid{flex:1;overflow-y:auto;display:grid;gap:15px;padding:15px;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));scroll-behavior:smooth;transition:0.3s;}
.card{background:linear-gradient(180deg,#202020,#111);border-radius:16px;padding:12px;text-align:center;cursor:pointer;border:2px solid transparent;transition:.25s;position:relative;}
.card img{width:70px;height:70px;margin-bottom:8px;object-fit:contain;border-radius:8px;}
.card span{font-size:14px;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.card:focus{transform:scale(1.1);border-color:var(--primary);box-shadow:var(--glow);z-index:10;}
.card .fav{position:absolute;top:6px;right:6px;font-size:18px;color:#ff0;display:none;}
.card.is-fav .fav{display:block;}

/* MOBILE RESPONSIVE */
@media(max-width:768px){
.video-box{height:35vh;}
.card img{width:60px;height:60px;}
.card span{font-size:13px;}
.cat-btn{font-size:12px;padding:6px 12px;}
.search{font-size:14px;padding:8px;}
#now{font-size:14px;padding:4px 8px;}
.grid{gap:12px;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));padding:10px;}
#loader{width:30px;height:30px;border-width:3px;border-top-width:3px;}
}
</style>
</head>
<body>

<div class="app">
<!-- Sidebar -->
<nav class="sidebar">
<button class="nav-btn active" onclick="filterCategory('All',this)">üè†</button>
<button class="nav-btn" onclick="filterCategory('Favorite',this)">‚≠ê</button>
</nav>

<!-- Main Content -->
<div class="main">
<div class="video-box" id="vbox" onclick="toggleFS()">
<div id="loader"></div>
<div id="now"></div>
<video id="player" autoplay playsinline webkit-playsinline></video>
</div>

<div class="top">
<input class="search" placeholder="‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." oninput="search(this.value)">
<div class="cat-bar" id="catBar">
<button class="cat-btn active" onclick="filterCategory('All',this)">All</button>
<button class="cat-btn" onclick="filterCategory('Favorite',this)">Favorite</button>
<button class="cat-btn" onclick="filterCategory('‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ',this)">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</button>
<button class="cat-btn" onclick="filterCategory('Sports',this)">Sports</button>
</div>
</div>

<div class="grid" id="grid"></div>
</div>
</div>

<script>
// ===== CONFIG =====
const M3U="https://raw.githubusercontent.com/soheltanver85-a11y/Live-tv2/main/Live-tv2";
const video=document.getElementById("player");
const grid=document.getElementById("grid");
const loader=document.getElementById("loader");
const now=document.getElementById("now");

let channels=[],filtered=[],current="",hls,favorites=JSON.parse(localStorage.getItem("tv_favs"))||[];

// ===== INIT =====
async function init(){
try{
let res=await fetch(M3U);
let data=await res.text();
parseData(data);
}catch(e){console.log("Load Error",e);}
}
function parseData(data){
let lines=data.split("\n"),item={};
lines.forEach(l=>{
if(l.startsWith("#EXTINF")){
item.name=l.split(",")[1]||"TV";
item.logo=l.match(/tvg-logo="(.*?)"/)?.[1]||"https://via.placeholder.com/100";
item.group=l.match(/group-title="(.*?)"/)?.[1]||"All";
}else if(l.startsWith("http")){
item.url=l.trim();
channels.push({...item});
item={};
}
});
filtered=[...channels];
render(filtered);

let last=localStorage.getItem("last_tv");
if(last) play(last);
}

// ===== RENDER CHANNELS =====
function render(list){
grid.innerHTML=list.map(c=>`
<div class="card ${favorites.includes(c.url)?'is-fav':''}" tabindex="0" onclick="play('${c.url}')" oncontextmenu="toggleFav(event,'${c.url}')">
<img src="${c.logo}">
<span>${c.name}</span>
<div class="fav">‚≠ê</div>
</div>`).join("");
}

// ===== PLAY =====
function play(url){
current=url;
localStorage.setItem("last_tv",url);
loader.style.display="block";

let ch=channels.find(x=>x.url===url);
now.innerText=ch?.name||"";

if(hls) hls.destroy();
if(Hls.isSupported()){
hls=new Hls({lowLatencyMode:true});
hls.loadSource(url);
hls.attachMedia(video);
hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
hls.on(Hls.Events.ERROR,(e,d)=>{if(d.fatal) next();});
}else{
video.src=url; video.play();
}

video.onplaying=()=>loader.style.display="none";
setTimeout(()=>{if(video.readyState<3) next();},7000);
}

// ===== NEXT CHANNEL =====
function next(){
if(filtered.length===0) return;
let i=filtered.findIndex(c=>c.url===current);
i=(i+1)%filtered.length;
play(filtered[i].url);
}

// ===== SEARCH =====
function search(q){
filtered=channels.filter(c=>c.name.toLowerCase().includes(q.toLowerCase()));
render(filtered);
}

// ===== CATEGORY =====
function filterCategory(cat,btn){
document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
document.querySelector('.search').value="";
filtered = (cat==='All') ? channels :
           (cat==='Favorite') ? channels.filter(c=>favorites.includes(c.url)) :
           channels.filter(c=>c.group.toLowerCase().includes(cat.toLowerCase()));
render(filtered);
grid.scrollTop=0; // scroll top fix for refresh
}

// ===== FAVORITES =====
function toggleFav(e,url){
e.preventDefault();
if(favorites.includes(url)){
favorites=favorites.filter(x=>x!==url);
}else{favorites.push(url);}
localStorage.setItem("tv_favs",JSON.stringify(favorites));
render(filtered);
}

// ===== FULLSCREEN =====
function toggleFS(){
!document.fullscreenElement?
document.getElementById("vbox").requestFullscreen():
document.exitFullscreen();
}

// ===== REMOTE KEYS =====
window.addEventListener("keydown",e=>{
let active=document.activeElement;
if(e.key==="ArrowUp") next();
if(e.key==="ArrowDown") next();
if(e.key==="Enter"){
if(active.classList.contains("card")) active.click();
if(active.id==="vbox") toggleFS();
}
});

// ===== PULL-DOWN REFRESH MOBILE =====
let touchStartY=0;
grid.addEventListener('touchstart',e=>{touchStartY=e.touches[0].clientY;});
grid.addEventListener('touchend',e=>{
let touchEndY=e.changedTouches[0].clientY;
if(touchEndY - touchStartY > 50){ render(filtered); grid.scrollTop=0; } // pull down refresh
});

init();
</script>
</body>
</html>
